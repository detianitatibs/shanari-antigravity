# テンキーでできるダメージ計算ツール業務要件定義書

## 1. 要件概要

### 1.1. 目的とゴール（What）
- **目的**: ポケモンゲームの対戦中に、技によるダメージ計算を迅速かつ簡易に実施するためのツールを提供する。
- **ゴール**:
    - 入力項目を最小限に抑え、素早い操作を可能にする。
    - 出力情報（確定数、乱数幅など）を充実させ、ユーザーの判断を支援する。
    - テンキーと矢印キーを中心とした操作系を実現する。
    - デスクトップだけでなく、縦画面タブレットでも視認性の高いレイアウトを提供する。

### 1.2. 背景（Why）
- 既存のダメージ計算ツールは入力項目（ポケモン名、努力値など）が多く、対戦中の緊急確認に向かない課題があった。
- 「おおよそで良いので、最低限の入力ですぐに結果を知りたい」というニーズに応える。

### 1.3. ターゲットユーザー
- ポケモン対戦プレイヤー（シングルバトル・ダブルバトル両対応）

## 2. スコープ

### 2.1. スコープ対象 (In-Scope)
- トップページおよびヘッダーからの「ダメージ計算ツール」への導線追加。
- 「ダメージ計算ツール」ページ単体の実装。
- 簡易な入力（威力、実数値、ランク、タイプ相性）によるダメージ計算ロジックの実装。

### 2.2. スコープ外 (Out-of-Scope)
- ポケモン種族値、技威力、特性などのデータベース構築・連携。
- 過去世代の計算式のサポート（現行最新世代のみ）。

## 3. 機能要件

### 3.1. 画面構成
ページは上下2分割の構成とする。
- **ヘッダー/説明**: ページタイトル「テンキーでできるダメージ計算ツール」、説明文を表示。将来的に操作説明ページへのリンクを追加想定。
- **Inputエリア (上部)**: 計算に必要な数値を入力する。
- **Outputエリア (下部)**: 計算結果を行列形式で表示する。

### 3.2. Inputエリア詳細
以下の項目を入力可能とする。

| 項目名 | 入力タイプ | デフォルト値 | 挙動・制約 |
| :--- | :--- | :--- | :--- |
| **威力** | 計算可能数値 | 空白 | 初期フォーカス位置。 |
| **攻撃実数値** | 計算可能数値 | 空白 | |
| **防御実数値** | 計算可能数値 | 空白 | |
| **HP** | 計算可能数値 | 空白 | 入力時、確定数や％表示が有効化される。 |
| **タイプ相性** | 選択 | 効果あり | 「かなり今ひとつ(0.25)」「今ひとつ(0.5)」「効果あり(1.0)」「効果抜群(2.0)」「効果超抜群(4.0)」から選択。<br>左右矢印キーで変更可能。選択項目は強調表示。 |
| **攻撃補正ランク** | ランク数値 | +0 | -6 〜 +6。上下矢印キーで増減。 |
| **防御補正ランク** | ランク数値 | +0 | -6 〜 +6。上下矢印キーで増減。 |

**操作性・挙動定義**:
- **フォーカス移動**:
    - `TAB` または `ENTER`: 次の項目へ移動（威力→攻撃→防御→HP→タイプ相性→攻撃補正ランク→防御補正ランク）。
    - `Shift + TAB`: 前の項目へ移動。
    - `ESC`: 全値をデフォルトにリセットし、威力にフォーカス。
- **計算可能数値 (威力/実数値/HP)**:
    - 四則演算（`+`, `-`, `*`, `/`, `()`）の入力を許可。
    - フォーカスアウト時（TAB/ENTER移動時）に計算を実行し、小数点以下切り捨ての整数に変換して表示。
    - フォーカス中の上下矢印キー: 値を+1/-1する。
    - マイナス値は入力不可（0に強制）。
- **ランク数値**:
    - 上下矢印キーまたは直接入力で -6 〜 +6 を指定。範囲外は自動補正。

### 3.3. Outputエリア詳細
計算結果を表形式（マトリクス）で表示する。

**表の構造**:
- **列 (Column)**:
    1. **カテゴリ1**: シングルダメージ / ダブルダメージ
    2. **カテゴリ2 (各カテゴリ1内)**: 通常 / 壁込み（リフレクター/ひかりのかべ反映）
- **行 (Row)**:
    1. **カテゴリ1**: タイプ不一致 / タイプ一致 / テラスタイプ不一致 / テラスタイプ一致
        - **折りたたみ機能**: 各行は開閉可能。
    2. **カテゴリ2 (展開時)**: ダメージ補正 1.1倍 〜 2.0倍 (0.1刻み)

**表示内容**:
- **セル内の情報**:
    - **ダメージ幅**: 「最低乱数値 〜 最高乱数値」を表示。
    - **乱数詳細 (展開時)**: 最低〜最高までの16段階の乱数値をリスト表示。
    - **確定数/割合 (HP入力時)**:
        - ダメージ幅の下に「最低% 〜 最高%」を表示。
        - **文字色**:
            - 確定1発（最低乱数がHP以上）: **赤色**
            - 確定2発（最低乱数*2 < HP <= 最高乱数*2 ...の目安だが、要件では「2倍とした場合に超える場合は青色」）
                - 正確な要件: 「最低乱数値、または最高乱数値がそのHPを上回っている場合は赤色」（＝1発で倒せる可能性がある）
                - 「2倍とした場合に超える場合は青色」（＝2発で倒せる可能性がある）
- **エラー表示**: 計算不能時は「? 〜 ?」と表示。

## 4. 非機能要件

### 4.1. パフォーマンス
- **リアルタイム反映**: Inputエリアの値変更やフォーカス移動のたびに即座に再計算し、Outputエリアを更新する。

### 4.2. UI/UX・デザイン
- **入力効率**: 威力〜タイプ相性までは極力1行に収め、視線の移動を減らす。
- **配置**: 攻撃補正ランクは攻撃実数値の下、防御補正ランクは防御実数値の下に配置し、関係性を明確にする。
- **視認性**: 「最低乱数値 〜 最高乱数値」を大きく目立たせる。
- **レスポンシブ**: PC、タブレット（縦）、スマホでレイアウト崩れがないようにする。既存サイトのデザイン（Tailwind CSS, フォント等）を踏襲する。
- **多言語対応の準備**: 将来的なi18n対応を考慮した実装構造とする（今回は日本語のみで可）。

## 5. 参照ドキュメント
- `docs/01_rd/pokemon-damage-calculation-definition.md`: ダメージ計算ロジックの詳細定義。
