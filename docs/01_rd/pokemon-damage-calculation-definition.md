# ポケモンSV（第九世代）ダメージ計算式とインプット変数

ポケモンSV（第九世代）のダメージ計算は、以下の基本式と、それに乗算される多くの補正値が、定められた**計算順序**と**特有の小数点処理**を経て適用されることで確定します。

---

## 1. ダメージ計算の基本式とステップ

### I. 基礎ダメージ（A/B項）の計算

ダメージ計算の基礎となる部分です。

$$\text{Damage Base} = \lfloor \frac{(\lfloor \frac{\text{Level} \times 2}{5} \rfloor + 2) \times \text{Final Power} \times \text{Final Att/SpA}}{\text{Final Def/SpD} \times 50} \rfloor + 2$$

| 変数 | 定義 |
|:---|:---|
| $\text{Level}$ | 攻撃側のレベル（**L**） |
| $\text{Final Power}$ | 【2】最終威力 |
| $\text{Final Att/SpA}$ | 【4】最終攻撃（こうげき or とくこう） |
| $\text{Final Def/SpD}$ | 【6】最終防御（ぼうぎょ or とくぼう） |

---

### II. 補正項の計算順序と小数点処理

最終ダメージは、上記で計算した $\text{Damage Base}$ に、以下のステップを経て算出された **【2】最終威力**、**【4】最終攻撃**、**【6】最終防御** を適用し、さらに最終補正項（【8】）を順に乗算することで確定します。

#### 小数点以下の処理の定義

| 処理 | 記号 | 意味 |
|:---|:---|:---|
| **切り捨て** | $\lfloor \cdot \rfloor$ | 小数点以下を切り捨てます。 |
| **五捨五超入** | $\text{Round}_{0.5 \downarrow 0}$ | $0.5$以下は切り捨て、$0.5$より大きい場合は切り上げます（**伝統的なポケモンの切り上げ処理**）。 |
| **四捨五入** | $\text{Round}$ | 一般的な四捨五入。 |

#### 【1】威力の補正値 (Power Mod.)
特定の特性（例：テクニシャン、かたいツメ）、道具（例：プレート）、フィールド効果などによる補正値を初期値4096に乗算/除算し、**四捨五入**して求めます。

#### 【2】最終威力 (Final Power)
$$\text{Final Power} = \text{Round}_{0.5 \downarrow 0}(\frac{\text{Base Power} \times \text{Power Mod. [1]}}{4096})$$

* **処理:** **五捨五超入**
* **例外:** 結果が**1未満の場合は1**。テラスタル時の威力60未満の技は**60**に補正（一部例外あり）。

#### 【4】最終攻撃 (Final Att/SpA)
攻撃側の実数値にランク補正、特性補正（はりきり）、【3】攻撃の補正値を順に適用します。

1.  **ランク補正:** $\text{Rank Att/SpA} = \lfloor \text{Base Att/SpA} \times \text{Rank Multiplier} \rfloor$ （**切り捨て**）
2.  **はりきり:** $\text{Hustle Att/SpA} = \lfloor \text{Rank Att/SpA} \times \frac{6144}{4096} \rfloor$ （**切り捨て**、適用時のみ）
3.  **【3】補正:** $\text{Final Att/SpA} = \text{Round}_{0.5 \downarrow 0}(\frac{\text{Hustle Att/SpA} \times \text{Att Mod. [3]}}{4096})$ （**五捨五超入**）

* **例外:** 結果が**1未満の場合は1**。

#### 【6】最終防御 (Final Def/SpD)
防御側の実数値にランク補正、天候補正、【5】防御の補正値を順に適用します。

1.  **ランク補正:** $\text{Rank Def/SpD} = \lfloor \text{Base Def/SpD} \times \text{Rank Multiplier} \rfloor$ （**切り捨て**）
2.  **天候防御強化:** $\text{Weather Def/SpD} = \lfloor \text{Rank Def/SpD} \times \frac{6144}{4096} \rfloor$ （**切り捨て**、砂嵐/雪による強化時のみ）
3.  **【5】補正:** $\text{Final Def/SpD} = \text{Round}_{0.5 \downarrow 0}(\frac{\text{Weather Def/SpD} \times \text{Def Mod. [5]}}{4096})$ （**五捨五超入**）

* **例外:** 結果が**1未満の場合は1**。

#### 【8】最終ダメージ補正項の適用

「I. 基礎ダメージ」の結果に、以下の補正項を**厳密にこの順番**で乗算し、都度小数点処理を行います。

| 順序 | 補正要素 | 補正値（4096を1.00とする） | 処理 |
|:---|:---|:---|:---|
| **B** | $\text{Damage Base}$ | - | - |
| **1.** | 複数対象 | $3072/4096$ | **五捨五超入** |
| **2.** | おやこあい（2発目） | $1024/4096$ | **五捨五超入** |
| **3.** | 天気弱化（例：晴れ下のソーラービーム） | $2048/4096$ | **五捨五超入** |
| **4.** | 天気強化（例：晴れ下の炎技） | $6144/4096$ | **五捨五超入** |
| **5.** | きょけんとつげき/ダイマックス技補正 | $8192/4096$ | **五捨五超入** |
| **6.** | 急所 | $6144/4096$ | **五捨五超入** |
| **7.** | 乱数 | $0.85$ ～ $1.00$（16通り） | **切り捨て** |
| **8.** | STAB/適応力/テラスタル補正 | $6144/4096$, $8192/4096$, $9216/4096$ | **五捨五超入** |
| **9.** | タイプ相性 | $0, 0.5, 1, 2, 4$ | **切り捨て** |
| **10.**| やけど（物理技） | $2048/4096$ | **五捨五超入** |
| **11.**| 【7】ダメージの補正値 | $\text{Damage Mod. [7]}/4096$ | **五捨五超入** |
| **12.**| まもる（Z技・ダイマックス技） | $1024/4096$ | **五捨五超入** |

最終的に計算されたダメージが**1未満**（かつタイプ相性が0ではない）の場合、最終ダメージは**1**として確定します。

---

## 2. 必要となるインプット変数一覧

| カテゴリ | インプット変数 | 詳細 |
|:---|:---|:---|
| **基礎ステータス** | 攻撃側のレベル ($\text{Level}$) | |
| | 物理/特殊技の威力 ($\text{Base Power}$) | |
| | 攻撃側/防御側のこうげき・とくこう・ぼうぎょ・とくぼうの**実数値** | |
| **乱数** | 乱数 ($\text{Rand}$) | $0.85$ から $1.00$ までの16パターンの値 |
| **技・タイプ** | 技のタイプ、カテゴリ（物理/特殊） | |
| | 防御側のタイプ（テラスタイプを含む） | |
| | タイプ相性 ($\text{Type Multiplier}$) | |
| **ステータスランク** | こうげき/とくこう/ぼうぎょ/とくぼうの**ランク補正** | -6～+6 |
| **状態・場** | **やけど**の有無 | (物理技のダメージに影響) |
| | **急所**の有無 | (ランク補正無視とダメージ補正) |
| | **天候**の種類と状態 | (天気による威力強化/弱化、防御強化) |
| | **場**の種類（エレキ/グラス/サイコ/ミスト） | (威力強化/弱化) |
| | **複数対象**の有無 | (ダブルバトル等での0.75倍補正) |
| **特性・道具** | 【1】威力補正に関わる特性・道具 | (例: テクニシャン、プレート) |
| | 【3】攻撃補正に関わる特性・道具 | (例: ちからもち、こだわりハチマキ) |
| | 【5】防御補正に関わる特性・道具 | (例: しんかのきせき、ファーコート) |
| | 【7】ダメージ補正に関わる特性・道具・壁 | (例: いのちのたま、リフレクター) |
| **特殊効果** | **テラスタル**の有無とテラスタイプ | |
| | **おやこあい**（2発目）のフラグ | |
| | **まもる**（Z技・ダイマックス技）のフラグ | |